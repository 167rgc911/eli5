{% if dense_multitarget %}

    {% if force_weights or not (expl.targets|get_top_target).weighted_spans %}
        <table style="{{ dense_multitarget_table_styles }}">
            <tr>
                {% for target in expl.targets %}
                    <td style="{{ dense_multitarget_td_styles }}">
                        {% if force_weights or not target.weighted_spans %}
                            {% with wts = target.feature_weights %}
                                {% set inline_target_header = True %}
                                {% include "weights_table.html" with context %}
                            {% endwith %}
                        {% endif %}
                    </td>
                {% endfor %}
            </tr>
        </table>
    {% endif %}

    {% with target = expl.targets|get_top_target %}
        {% if target %}
            {% include "weighted_spans.html" with context %}
        {% endif %}
    {% endwith %}

{% else %}

    {% for target in expl.targets %}

        {% if force_weights or not target.weighted_spans %}
            {% with wts = target.feature_weights %}
                {% set inline_target_header = False %}
                {% include "weights_table.html" with context %}
            {% endwith %}
        {% endif %}

        {% include "weighted_spans.html" with context %}

    {% endfor %}
{% endif %}
